<html>
<head>
<script src="../../http/tests/inspector/inspector-test.js"></script>
<script src="../../http/tests/inspector/debugger-test.js"></script>

<script>

function test()
{
    // Always use indentation in scripts drop box
    WebInspector._isMac = false;

    var uiSourceCodes = [];
    function addUISourceCode(url)
    {
        var uiSourceCode = new WebInspector.UISourceCode(0, url, null, null);
        comboBoxFileSelector.addUISourceCode(uiSourceCode);
        uiSourceCodes.push(uiSourceCode);
    }

    function checkCurrentlySelectedFileName(fileName)
    {
        var index = comboBoxFileSelector._filesSelectElement.selectedIndex;
        var text = comboBoxFileSelector._filesSelectElement[index].text;
        InspectorTest.assertTrue(text.indexOf(fileName) !== -1,
            "Wrong option text. Expected <" + fileName + ">, found <" + text + ">.");
    }

    var comboBoxFileSelector = new WebInspector.ScriptsPanel.ComboBoxFileSelector();

    var files = ["index.html", "script1.js", "script2.js", "script3.js"];
    for (var i = 0; i < files.length; ++i)
        addUISourceCode(files[i]);

    for (var i = 0; i < uiSourceCodes.length; ++i)
        comboBoxFileSelector.revealUISourceCode(uiSourceCodes[i]);

    checkCurrentlySelectedFileName("script3.js");
    InspectorTest.assertEquals(true, comboBoxFileSelector.forwardButton.disabled, "Forward should be disabled.");

    comboBoxFileSelector.backButton.click();
    checkCurrentlySelectedFileName("script2.js");
    InspectorTest.assertEquals(false, comboBoxFileSelector.forwardButton.disabled, "Forward should be enabled after back button click.");

    comboBoxFileSelector.forwardButton.click();
    checkCurrentlySelectedFileName("script3.js");
    InspectorTest.assertEquals(true, comboBoxFileSelector.forwardButton.disabled, "Forward should be disabled after forward button click.");

    comboBoxFileSelector.backButton.click();
    checkCurrentlySelectedFileName("script2.js");

    comboBoxFileSelector.backButton.click();
    checkCurrentlySelectedFileName("script1.js");

    comboBoxFileSelector.backButton.click();
    checkCurrentlySelectedFileName("index.html");

    comboBoxFileSelector.forwardButton.click();
    comboBoxFileSelector.forwardButton.click();
    checkCurrentlySelectedFileName("script2.js");

    comboBoxFileSelector.revealUISourceCode(uiSourceCodes[1]);

    checkCurrentlySelectedFileName("script1.js");
    InspectorTest.assertEquals(true, comboBoxFileSelector.forwardButton.disabled);

    comboBoxFileSelector.backButton.click();
    checkCurrentlySelectedFileName("script2.js");

    comboBoxFileSelector.backButton.click();
    checkCurrentlySelectedFileName("index.html");

    InspectorTest.completeTest();
};

</script>

</head>

<body onload="runTest()">
<p>Tests scripts panel combo box file selector history.</p>

</body>
</html>
