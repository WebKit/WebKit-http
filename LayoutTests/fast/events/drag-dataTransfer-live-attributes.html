<!DOCTYPE html>
<html>
<head>
<style>
#drag {
    border: 1px solid black;
    height: 200px;
    width: 200px;
}
#drop {
    border: 1px solid black;
    height: 200px;
    width: 200px;
}
</style>
<script>
var failed;

function log(str)
{
    var result = document.getElementById('result');
    result.appendChild(document.createTextNode(str));
    result.appendChild(document.createElement('br'));
}
function dragstart(event)
{
    failed = false;
    event.dataTransfer.setData('text', 'sample');
    if (event.dataTransfer.types != event.dataTransfer.types) {
        failed = true;
        log('types != types');
    }
    if (event.dataTransfer.files != event.dataTransfer.files) {
        failed = true;
        log('files != files');
    }
    if (event.dataTransfer.items != event.dataTransfer.items) {
        failed = true;
        log('items != items');
    }
}
function dragenter(event)
{
    event.preventDefault();
}
function dragover(event)
{
    event.preventDefault();
}
function drop(event)
{
    if (!event.dataTransfer.types.contains('text/plain'))
        failed = true;
    if (event.dataTransfer.getData('text') != 'sample')
        failed = true;
    log(failed ? 'FAILURE' : 'SUCCESS');
    if (window.layoutTestController)
        layoutTestController.notifyDone();
}
window.onload = function()
{
    if (!window.layoutTestController)
        return;
    layoutTestController.dumpAsText();
    layoutTestController.waitUntilDone();

    var dragElement = document.getElementById('drag');
    eventSender.mouseMoveTo(dragElement.offsetLeft + dragElement.offsetWidth / 2,
                            dragElement.offsetTop + dragElement.offsetHeight / 2);
    eventSender.mouseDown();
    eventSender.leapForward(100);
    var dropElement = document.getElementById('drop');
    eventSender.mouseMoveTo(dropElement.offsetLeft + dropElement.offsetWidth / 2,
                            dropElement.offsetTop + dropElement.offsetHeight / 2);
    eventSender.mouseUp();
}
</script>
</head>
<body>
<p>This is a test that various dataTransfer attributes are live and return the same object when accessed multiple times. To manually test, drag 'Drag Me' to 'Drop Here' and drop. The word 'SUCCESS' should appear.
<div draggable="true" id="drag" ondragstart="dragstart(event)">Drag Me</div>
<div id="drop" ondragenter="dragenter(event)" ondragover="dragover(event)" ondrop="drop(event)">Drop Here</div>
</div>
<div id="result"></div>
</body>
</html>
