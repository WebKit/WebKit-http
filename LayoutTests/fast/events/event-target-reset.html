<!DOCTYPE html>
<html>
<body>
<p id="description">
Tests that events don't have their target reset to null after being
dispatched.
</p>
<pre id="console"></pre>
<script>
if (window.layoutTestController) {
    layoutTestController.dumpAsText();
    layoutTestController.waitUntilDone();
}

// We do ad-hoc logging and assertions here because external scripts
// generate their own load events that complicate the test.

function log(msg) {
    document.querySelector('#console').appendChild(document.createTextNode(msg + '\n'));
}

function shouldBeTrue(condition) {
    var msg = (eval(condition) ? 'PASS ' : 'FAIL ') + condition;
    log(msg);
}

var savedEvent;

function saveEvent(event) {
    shouldBeTrue('event.target.tagName == "IFRAME"');
    savedEvent = event;
    window.setTimeout(checkSavedEvent, 0);
}

function checkSavedEvent() {
    shouldBeTrue('savedEvent.target.tagName == "IFRAME"');
    log('\nTEST COMPLETE');

    if (window.layoutTestController)
        layoutTestController.notifyDone();
}

document.addEventListener('load', saveEvent, true);
document.write('<iframe></iframe>');
</script>
</body>
</html>
